<% content_for :title, "#{@product.name} - Swimi" %>

<div class="container py-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><%= link_to "Home", root_path %></li>
      <li class="breadcrumb-item"><%= link_to "Products", products_path %></li>
      <li class="breadcrumb-item"><%= link_to @product.category.name, category_path(@product.category) %></li>
      <li class="breadcrumb-item active" aria-current="page"><%= @product.name %></li>
    </ol>
  </nav>

  <div class="row">
    <!-- Product Image -->
    <div class="col-md-6">
      <img src="<%= @product.image_url %>" class="img-fluid rounded" alt="<%= @product.name %>">
    </div>

    <!-- Product Details -->
    <div class="col-md-6">
      <h1><%= @product.name %></h1>
      <p class="text-muted mb-3">
        <strong>Category:</strong> <%= link_to @product.category.name, category_path(@product.category), class: "text-decoration-none" %>
      </p>
      
      <div class="mb-3">
        <span class="price display-6 text-primary">$<%= @product.price %></span>
      </div>

      <div class="mb-3">
        <strong>Size:</strong> <span class="badge bg-secondary"><%= @product.size %></span>
      </div>

      <div class="mb-4">
        <% if @product.stock > 0 %>
          <span class="badge bg-success">In Stock (<%= @product.stock %> available)</span>
        <% else %>
          <span class="badge bg-danger">Out of Stock</span>
        <% end %>
      </div>

      <div class="mb-4">
        <h5>Description</h5>
        <p><%= @product.description %></p>
      </div>

      <!-- Action Buttons -->
      <div class="d-grid gap-2 d-md-block">
        <% if user_signed_in? %>
          <% if @product.stock > 0 %>
            <%= link_to "Add to Cart", add_to_cart_path(@product), 
                data: { turbo_method: :post }, class: "btn btn-primary btn-lg" %>
          <% else %>
            <button class="btn btn-secondary btn-lg" disabled>Out of Stock</button>
          <% end %>
        <% else %>
          <%= link_to "Sign in to Purchase", new_user_session_path, class: "btn btn-outline-primary btn-lg" %>
        <% end %>
        <%= link_to "Back to Products", products_path, class: "btn btn-outline-secondary btn-lg" %>
      </div>
    </div>
  </div>

  <!-- Related Products -->
  <% if @related_products.any? %>
    <hr class="my-5">
    <h3>Related Products</h3>
    <div class="row">
      <% @related_products.each do |product| %>
        <div class="col-lg-3 col-md-6 mb-4">
          <div class="card product-card h-100">
            <img src="<%= product.image_url %>" class="card-img-top product-image" alt="<%= product.name %>">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title"><%= product.name %></h5>
              <p class="card-text flex-grow-1">
                Size: <%= product.size %><br>
                <%= truncate(product.description, length: 60) %>
              </p>
              <div class="mt-auto">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="price">$<%= product.price %></span>
                </div>
                <%= link_to "View Details", product_path(product), class: "btn btn-primary w-100" %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
