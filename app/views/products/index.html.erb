<% content_for :title, "Products - Swimi" %>

<div class="container py-4">
  <!-- Page Header and Search -->
  <div class="row mb-4">
    <div class="col-md-6">
      <h1>
        <% if @current_category %>
          <%= @current_category.name %>
        <% else %>
          All Products
        <% end %>
      </h1>
    </div>
  <!-- Advanced Search Section -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">
        <i class="fas fa-search"></i> Search Products
      </h5>
    </div>
    <div class="card-body">
      <%= form_with url: products_path, method: :get, local: true do |f| %>
        <div class="row g-3">
          <div class="col-md-6">
            <%= f.label :search, "Search by keyword", class: "form-label" %>
            <%= f.text_field :search, placeholder: "Enter product name or description...", 
                            value: params[:search], class: "form-control" %>
            <div class="form-text">Search in product names and descriptions</div>
          </div>
          
          <div class="col-md-4">
            <%= f.label :category, "Filter by category", class: "form-label" %>
            <%= f.select :category, 
                options_from_collection_for_select(@categories, :name, :name, params[:category]),
                { prompt: "All Categories" }, 
                { class: "form-select" } %>
          </div>
          
          <div class="col-md-2">
            <%= f.label :filter, "Special filters", class: "form-label" %>
            <%= f.select :filter, 
                options_for_select([
                  ['All Products', ''],
                  ['On Sale', 'sale'],
                  ['New Products', 'new'],
                  ['Recently Updated', 'updated']
                ], params[:filter]),
                {}, 
                { class: "form-select" } %>
          </div>
          
          <div class="col-md-2 d-flex align-items-end">
            <div class="d-grid w-100">
              <%= f.submit "Search", class: "btn btn-primary" %>
            </div>
          </div>
        </div>
        
        <% if params[:search].present? || params[:category].present? || params[:filter].present? %>
          <div class="mt-3">
            <%= link_to "Clear all filters", products_path, class: "btn btn-outline-secondary btn-sm" %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
  </div>

    <!-- Search Results Info -->
  <% if params[:search].present? || params[:category].present? || params[:filter].present? %>
    <div class="alert alert-info d-flex justify-content-between align-items-center">
      <div>
        <i class="fas fa-info-circle me-2"></i>
        <% filter_info = [] %>
        <% filter_info << "searching for \"#{params[:search]}\"" if params[:search].present? %>
        <% filter_info << "in category \"#{params[:category]}\"" if params[:category].present? %>
        <% case params[:filter]
           when 'sale' %>
          <% filter_info << "showing products on sale" %>
        <% when 'new' %>
          <% filter_info << "showing new products" %>
        <% when 'updated' %>
          <% filter_info << "showing recently updated products" %>
        <% end %>
        
        Showing <%= pluralize(@products.count, 'product') %>
        <% if filter_info.any? %>
          <%= filter_info.join(', ') %>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Products Grid -->
  <div class="row">
    <% if @products.any? %>
      <% @products.each do |product| %>
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
          <%= render 'shared/product_card', product: product %>
        </div>
      <% end %>
    <% else %>
      <div class="col-12">
        <div class="text-center py-5">
          <h3>No products found</h3>
          <p class="text-muted">Try adjusting your search terms or browse all products.</p>
          <%= link_to "View All Products", products_path, class: "btn btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Pagination -->
  <% if @products.respond_to?(:current_page) %>
    <div class="d-flex justify-content-center mt-4">
      <%= paginate @products %>
    </div>
  <% end %>
</div>
