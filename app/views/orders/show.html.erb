<% content_for :title, "Order ##{@order.id} Details - Swimi" %>

<div class="container py-4">
  <div class="row">
    <div class="col-12">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>
          <i class="fas fa-receipt me-2"></i>Order #<%= @order.id %> Details
        </h1>
        <div>
          <%= link_to "Back to Orders", orders_path, class: "btn btn-outline-secondary" %>
          <% if @order.status == 'delivered' %>
            <button class="btn btn-outline-primary" disabled>
              <i class="fas fa-star me-1"></i>Leave Review
            </button>
          <% end %>
        </div>
      </div>

      <div class="row">
        <!-- Order Information -->
        <div class="col-lg-8">
          <!-- Order Status -->
          <div class="card mb-4">
            <div class="card-header bg-<%= order_status_class(@order.status) %> text-white">
              <h5 class="mb-0">
                <i class="<%= order_status_icon(@order.status) %> me-2"></i>
                Order Status: <%= @order.status.humanize %>
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4">
                  <strong>Order Date:</strong><br>
                  <%= @order.created_at.strftime("%B %d, %Y at %I:%M %p") %>
                </div>
                <div class="col-md-4">
                  <strong>Last Updated:</strong><br>
                  <%= @order.updated_at.strftime("%B %d, %Y at %I:%M %p") %>
                </div>
                <div class="col-md-4">
                  <strong>Total Amount:</strong><br>
                  <span class="text-success fs-5">$<%= @order.total %></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Items -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-box me-2"></i>Items Ordered
              </h5>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-striped mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Product</th>
                      <th>Size</th>
                      <th>Price</th>
                      <th>Quantity</th>
                      <th>Subtotal</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @order.order_items.each do |item| %>
                      <tr>
                        <td>
                          <div class="d-flex align-items-center">
                            <img src="<%= item.product.image_url %>" alt="<%= item.product.name %>" 
                                 style="width: 50px; height: 50px; object-fit: cover;" class="rounded me-3">
                            <div>
                              <strong><%= link_to item.product.name, product_path(item.product), 
                                  class: "text-decoration-none" %></strong>
                              <br>
                              <small class="text-muted"><%= item.product.category.name %></small>
                            </div>
                          </div>
                        </td>
                        <td><%= item.product.size %></td>
                        <td>$<%= item.price %></td>
                        <td><%= item.quantity %></td>
                        <td><strong>$<%= item.quantity * item.price %></strong></td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Order Summary & Shipping -->
        <div class="col-lg-4">
          <!-- Order Summary -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-calculator me-2"></i>Order Summary
              </h5>
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between mb-2">
                <span>Subtotal:</span>
                <span>$<%= @order.subtotal %></span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>Tax (<%= @order.province.tax_rate %>%):</span>
                <span>$<%= @order.tax %></span>
              </div>
              <hr>
              <div class="d-flex justify-content-between mb-0">
                <strong>Total:</strong>
                <strong class="text-success">$<%= @order.total %></strong>
              </div>
            </div>
          </div>

          <!-- Shipping Information -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-truck me-2"></i>Shipping Information
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <strong>Delivery Address:</strong><br>
                <%= @order.shipping_name %><br>
                <%= @order.shipping_address %><br>
                <%= @order.shipping_city %>, <%= @order.province.name %><br>
                <%= @order.shipping_postal_code %>
              </div>
              
              <% if @order.status == 'shipped' || @order.status == 'delivered' %>
                <div class="alert alert-info mb-0">
                  <i class="fas fa-info-circle me-2"></i>
                  <% if @order.status == 'shipped' %>
                    <strong>Your order has been shipped!</strong><br>
                    Estimated delivery: 3-5 business days
                  <% else %>
                    <strong>Your order has been delivered!</strong><br>
                    Thank you for shopping with us!
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Customer Support -->
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-headset me-2"></i>Need Help?
              </h5>
            </div>
            <div class="card-body">
              <p class="small mb-3">
                Have questions about your order? Our customer support team is here to help!
              </p>
              <div class="d-grid gap-2">
                <button class="btn btn-outline-primary btn-sm" disabled>
                  <i class="fas fa-envelope me-1"></i>Contact Support
                </button>
                <button class="btn btn-outline-secondary btn-sm" disabled>
                  <i class="fas fa-phone me-1"></i>Call Us
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
