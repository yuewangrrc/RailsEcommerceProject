<% content_for :title, "Product Details - #{@product.name}" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>
    <i class="fas fa-box me-2"></i>Product Details
  </h1>
  <div class="btn-group">
    <%= link_to "Edit Product", edit_admin_product_path(@product), class: "btn btn-warning" %>
    <%= link_to "Back to Products", admin_products_path, class: "btn btn-outline-secondary" %>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <!-- Product Images -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-images me-2"></i>Product Images
        </h5>
      </div>
      <div class="card-body">
        <% if @product.images.attached? %>
          <!-- Primary Image -->
          <div class="text-center mb-3">
            <%= image_tag @product.primary_image, alt: @product.name,
                class: "img-fluid rounded shadow", style: "max-height: 300px;" %>
          </div>
          
          <!-- Additional Images -->
          <% if @product.images.count > 1 %>
            <div class="row">
              <% @product.images.drop(1).each do |image| %>
                <div class="col-4 mb-2">
                  <%= image_tag image, alt: @product.name,
                      class: "img-fluid rounded", style: "height: 80px; object-fit: cover; width: 100%;" %>
                </div>
              <% end %>
            </div>
          <% end %>
        <% elsif @product.image_url.present? %>
          <!-- Fallback to URL Image -->
          <div class="text-center">
            <img src="<%= @product.image_url %>" alt="<%= @product.name %>" 
                 class="img-fluid rounded shadow" style="max-height: 300px;">
            <small class="d-block text-muted mt-2">External Image</small>
          </div>
        <% else %>
          <!-- No Image Placeholder -->
          <div class="text-center">
            <div class="bg-light rounded d-flex align-items-center justify-content-center" 
                 style="height: 300px;">
              <div class="text-muted">
                <i class="fas fa-image fa-3x mb-2"></i>
                <div>No Image Available</div>
              </div>
            </div>
          </div>
        <% end %>
        
        <!-- Upload Status -->
        <div class="mt-3 text-center">
          <% if @product.images.attached? %>
            <span class="badge bg-success">
              <i class="fas fa-check me-1"></i>
              <%= pluralize(@product.images.count, 'image') %> uploaded
            </span>
          <% end %>
          <% if @product.image_url.present? %>
            <span class="badge bg-info">
              <i class="fas fa-link me-1"></i>
              URL image set
            </span>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-6">
    <!-- Product Information -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-info-circle me-2"></i>Product Information
        </h5>
      </div>
      <div class="card-body">
        <table class="table table-borderless">
          <tr>
            <th style="width: 30%;">Name:</th>
            <td><strong><%= @product.name %></strong></td>
          </tr>
          <tr>
            <th>Category:</th>
            <td>
              <span class="badge bg-info fs-6"><%= @product.category.name %></span>
            </td>
          </tr>
          <tr>
            <th>Size:</th>
            <td><%= @product.size %></td>
          </tr>
          <tr>
            <th>Price:</th>
            <td>
              <span class="text-success fw-bold fs-5">$<%= @product.price %></span>
            </td>
          </tr>
          <tr>
            <th>Stock:</th>
            <td>
              <span class="badge bg-<%= @product.stock_status_class %> fs-6">
                <%= @product.stock_status %> (<%= @product.stock %> units)
              </span>
            </td>
          </tr>
          <tr>
            <th>Status:</th>
            <td>
              <% if @product.active? %>
                <span class="badge bg-success fs-6">Active</span>
              <% else %>
                <span class="badge bg-secondary fs-6">Inactive</span>
              <% end %>
            </td>
          </tr>
          <tr>
            <th>Created:</th>
            <td><%= @product.created_at.strftime("%B %d, %Y at %I:%M %p") %></td>
          </tr>
          <tr>
            <th>Last Updated:</th>
            <td><%= @product.updated_at.strftime("%B %d, %Y at %I:%M %p") %></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Product Description -->
<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0">
      <i class="fas fa-align-left me-2"></i>Product Description
    </h5>
  </div>
  <div class="card-body">
    <p class="mb-0"><%= simple_format(@product.description) %></p>
  </div>
</div>

<!-- Action Buttons -->
<div class="card">
  <div class="card-header bg-light">
    <h5 class="mb-0">
      <i class="fas fa-cogs me-2"></i>Actions
    </h5>
  </div>
  <div class="card-body">
    <div class="d-flex gap-2 flex-wrap">
      <%= link_to edit_admin_product_path(@product), class: "btn btn-warning" do %>
        <i class="fas fa-edit me-1"></i>Edit Product
      <% end %>
      
      <% if @product.active? %>
        <%= link_to admin_product_path(@product), method: :patch,
            data: { confirm: "Are you sure you want to deactivate this product?" },
            class: "btn btn-outline-secondary" do %>
          <i class="fas fa-pause me-1"></i>Deactivate
        <% end %>
      <% else %>
        <%= link_to admin_product_path(@product), method: :patch,
            data: { confirm: "Are you sure you want to activate this product?" },
            class: "btn btn-outline-success" do %>
          <i class="fas fa-play me-1"></i>Activate
        <% end %>
      <% end %>
      
      <%= link_to admin_product_path(@product),
          class: "btn btn-danger",
          data: { 
            turbo_method: :delete,
            turbo_confirm: "Are you absolutely sure you want to delete '#{@product.name}'? This action cannot be undone!" 
          } do %>
        <i class="fas fa-trash me-1"></i>Delete Product
      <% end %>
      
      <%= link_to admin_products_path, class: "btn btn-outline-primary" do %>
        <i class="fas fa-arrow-left me-1"></i>Back to Products
      <% end %>
      
      <%= link_to product_path(@product), target: "_blank", class: "btn btn-outline-info" do %>
        <i class="fas fa-external-link-alt me-1"></i>View on Store
      <% end %>
    </div>
  </div>
</div>

<!-- Related Products (if needed) -->
<% if @product.category.products.where.not(id: @product.id).any? %>
  <div class="card mt-4">
    <div class="card-header">
      <h5 class="mb-0">
        <i class="fas fa-layer-group me-2"></i>Other Products in <%= @product.category.name %>
      </h5>
    </div>
    <div class="card-body">
      <div class="row">
        <% @product.category.products.where.not(id: @product.id).limit(6).each do |related_product| %>
          <div class="col-md-2 mb-3">
            <div class="card">
              <img src="<%= related_product.image_url %>" class="card-img-top" 
                   style="height: 100px; object-fit: cover;" alt="<%= related_product.name %>">
              <div class="card-body p-2">
                <h6 class="card-title small mb-1"><%= related_product.name %></h6>
                <p class="card-text small text-muted mb-1">$<%= related_product.price %></p>
                <%= link_to "View", admin_product_path(related_product), 
                    class: "btn btn-sm btn-outline-primary" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
